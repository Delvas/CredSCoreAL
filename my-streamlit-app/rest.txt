with st.form("my_form"):
...     st.write("Inside the form")
...     slider_val = st.slider("Form slider")
...     checkbox_val = st.checkbox("Form checkbox")
...
...     # Every form must have a submit button.
...     submitted = st.form_submit_button("Submit")
...     if submitted:
...         st.write("slider", slider_val, "checkbox", checkbox_val)
>>> st.write("Outside the form")




with st.form("credit_form"):
    st.subheader("ğŸ‘¤ Informations Personnelles")
    age = st.number_input("Ã‚ge", min_value=18, max_value=100, value=35)
    statut_propretaire = st.selectbox("Statut propriÃ©taire", ["PropriÃ©taire", "Locataire", "Autre"])
# Encodage simple : PropriÃ©taire=2, Locataire=1, Autre=0
    statut_propretaire_enc = {"PropriÃ©taire": 2, "Locataire": 1, "Autre": 0}[statut_propretaire]
    zone_habitat = st.number_input("Zone d'habitat : [Urbain:1, Rurale: 0]", min_value=0, max_value=1, value=0)
    Assurance_sante = st.number_input("Assurance SantÃ©: [Oui:1, Non: 0]", min_value=0, max_value=1, value=0)
    if age < 25:
        Classe_age = 1
    elif age>=25 and age < 35 :
        Classe_age = 2
    elif age >=35 and age < 50 :
        Classe_age = 3
    else:
        Classe_age= 4

# Informations financiÃ¨res / bancaires
    st.subheader("[ğŸ’°; ğŸ›ï¸] Informations FinanciÃ¨res / Bancaire")
    revenus_annuels = st.number_input("Revenus annuels", min_value=0,  value=45000, step=1000)
    type_pret = st.selectbox("CatÃ©gorie PrÃªt", ["Personnel", "Etude", "PME", "Immobilier", "Autre"])
    # Encodage simple : Personnel=0, Etude=1, PME=2, Immobilier=3, Autre=4
    type_pret_enc = {"Personnel": 0, "Etude": 1, "PME": 2, "Immobilier": 3, "Autre": 4}[type_pret]
    Historique_defaut = st.number_input(" Historique de defaut", min_value=0, value=1,step=1,max_value=1)
    duree_historique = st.number_input("DurÃ©e du prÃªt (annÃ©es)", min_value=1, max_value=30, value=10)
    montant_demande = st.number_input("Montant demandÃ©", min_value=1000, value=25000, step=1000)
    Taux_interet = st.number_input("Taux d'IntÃ©rÃªt", min_value=00, step=0.1 ,max_value=1,value=0.3)
    if revenus_annuels >= montant_demande*0.33 :
        cap_remb = 1
    else :
        cap_remb = 0 
    solde_moyen = st.number_input("Solde moyen ", min_value=0, value=5000, step=100 )
# Information alternatives
    recharge_mensuelle_moy=st.number_input("Recharge mensuelles moyenne", min_value=0,max_value=50,value=5)  
    solde_mobile_money_moy = st.number_input("Solde Mobile Money Moyen", min_value=0,max_value=2000000,value=1000)  
    whatsapp = st.number_input("AnciennetÃ© Whatsapp(annÃ©es)", min_value=0,max_value=50,value=5)
    Montant_facture_mensuel = st.number_input("Montant factures", min_value=0,max_value=5000000,value=5)
    ratio_facture_charge = 12 * (Montant_facture_mensuel / revenus_annuels  )
    indice_digit = ( whatsapp + recharge_mensuelle_moy + solde_mobile_money_moy) /3
    mature_finance = duree_historique / age
               
# Informations personnelles
st.form_submit_button("ğŸ”®Evaluer le Score de CrÃ©dit", type="primary")




# Bouton de prÃ©diction
predict_button = st.form_submit_button("ğŸ”®Evaluer le Score de CrÃ©dit", type="primary")
if predict_button and model is not None:
    features = np.array([ age,revenus_annuels,statut_propretaire_enc,
                type_pret_enc,montant_demande,Taux_interet,
                Historique_defaut,duree_historique,recharge_mensuelle_moy,
                solde_mobile_money_moy,whatsapp,Montant_facture_mensuel,
                zone_habitat,Assurance_sante,Classe_age,cap_remb,
                ratio_facture_charge,indice_digit,mature_finance]).reshape(1, -1)
            # PrÃ©diction
if hasattr(model, 'predict_proba'):
                prediction_proba = model.predict_proba(features)[0]
                prediction = model.predict(features)[0]
                st.success("âœ… PrÃ©diction rÃ©alisÃ©e!")
                credit_score = int(300 + (prediction_proba.max() * 550))
                if credit_score >= 740:
                    st.success("ğŸŸ¢ **Excellent** - CrÃ©dit approuvÃ© avec conditions favorables")
                    risk_level = "TrÃ¨s faible"
                elif credit_score >= 670:
                    st.info("ğŸŸ¡ **Bon** - CrÃ©dit probablement approuvÃ©")
                    risk_level = "Faible"
                elif credit_score >= 580:
                    st.warning("ğŸŸ  **Moyen** - CrÃ©dit Ã  examiner")
                    risk_level = "ModÃ©rÃ©"
                else:
                    st.error("ğŸ”´ **Faible** - Risque Ã©levÃ© de refus")
                    risk_level = "Ã‰levÃ©"
                st.write(f"**Niveau de risque:** {risk_level}")
                if len(prediction_proba) == 2:
                    st.write(f"**ProbabilitÃ© d'approbation:** {prediction_proba[1]:.1%}")
                    st.write(f"**ProbabilitÃ© de refus:** {prediction_proba[0]:.1%}")
                if prediction == 1:
                    st.success("ğŸŸ¢ **CrÃ©dit ApprouvÃ©**")
                else:
                    st.error("ğŸ”´ **CrÃ©dit RefusÃ©**")
else:
    prediction = model.predict(features)[0]
    st.success("âœ… PrÃ©diction rÃ©alisÃ©e!")
    if prediction == 1:
        st.success("ğŸŸ¢ **CrÃ©dit ApprouvÃ©**")
    else:
        st.error("ğŸ”´ **CrÃ©dit RefusÃ©**")
# Section d'analyse des facteurs
if model is not None:
    st.markdown("---")
    st.header("ğŸ“ˆ Analyse des Facteurs de Risque")
    
# Footer
st.markdown("---")
st.markdown("""
<div style='text-align: center; color: #666666; font-size: 0.8em;'>
    ğŸ¦ SystÃ¨me de PrÃ©diction de Score de CrÃ©dit | 
    DÃ©veloppÃ© avec Streamlit | 
    âš ï¸ Outil d'aide Ã  la dÃ©cision uniquement
</div>
""", unsafe_allow_html=True)

# Instructions d'utilisation
with st.sidebar.expander("ğŸ“– Instructions d'utilisation"):
    st.markdown("""
    ### Comment utiliser cette application:
    
    1. **Chargement du modÃ¨le:** 
       - Entrez le chemin vers votre modÃ¨le prÃ©-entraÃ®nÃ© dans la barre latÃ©rale
       - Formats supportÃ©s: .pkl (pickle) et .joblib
    
    2. **Saisie des donnÃ©es:**
       - Remplissez tous les champs du formulaire
       - Les donnÃ©es sont organisÃ©es par catÃ©gories pour faciliter la saisie
    
    3. **PrÃ©diction:**
       - Cliquez sur "PrÃ©dire le Score de CrÃ©dit"
       - Le systÃ¨me affichera le score et les probabilitÃ©s
    
    ### Variables utilisÃ©es:
                **DonnÃ©es TRaditionnelles**
    - **Personnelles:** Age,Statut_propriete,
    - **FinanciÃ¨res / Bancaires:** revenus,Assurance_sante, type d'emploi, anciennetÃ©, 
                , montant demandÃ©, Taux d'interÃªt, catÃ©gorie de prÃªt
                 historique de crÃ©dit, MaturitÃ© finaciÃ¨re,cap_remb
    - **DonnÃ©es alternatives** :AnciennetÃ© Whatsapp , Montant_factures_mensuelles, 
                Zone d'habitation, REcharge mensuelle, Solde Mobile_money, Indice_digitale,ratio_facture_charge ,
                
    - ** '', '',  

    
    ### Configuration des modÃ¨les:
    - **Dossier par dÃ©faut:** `models/` (modifiable)
    - **Formats supportÃ©s:** `.pkl` (pickle) et `.joblib`
    - **Actualisation:** Bouton pour rafraÃ®chir la liste des modÃ¨les
    - **Saisie manuelle:** Possible si aucun modÃ¨le n'est trouvÃ© dans le dossier
    
    ### Structure de dossier recommandÃ©e:
    ```
    votre_projet/
    â”œâ”€â”€ app.py (ce fichier)
    â”œâ”€â”€ models/
    â”‚   â”œâ”€â”€ model_v1.pkl
    â”‚   â”œâ”€â”€ model_v2.joblib
    â”‚   â””â”€â”€ best_model.pkl
    â””â”€â”€ requirements.txt
    ```
    
    ### Notes importantes:
    - Adaptez les variables selon votre modÃ¨le spÃ©cifique
    - VÃ©rifiez que l'encodage des variables correspond Ã  votre entraÃ®nement
    - Cet outil est une aide Ã  la dÃ©cision, pas un systÃ¨me de dÃ©cision automatique
    - En cas de difficultÃ©s veuillez contacter les personnes dont les noms figure dans 
      la section About
    """)